# AI Security Scanner - v4.6.0 Backend Features Plan
**Date:** 2025-10-14 01:25:00 UTC  
**Status:** Planning Phase  
**Goal:** Complete remaining backend features before UI development

---

## üìã Overview

Based on user feedback, we need to complete additional backend features before moving to Web UI development. The multi-server plugin was previously deferred in favor of VPN security, and now it's time to implement it along with other critical backend features.

---

## üéØ v4.6.0 Scope: Backend Completion

### Primary Goals

1. ‚úÖ **Multi-Server Management Plugin** - Centralized server management
2. **Notifications & Alerting Plugin** - Real-time notifications
3. **Webhooks Plugin** - External integrations
4. **Advanced Reporting Plugin** - Enhanced reports

### Why These Features?

**Multi-Server Management:**
- Already has basic implementation in `/multi-server/`
- Critical for enterprise deployments
- Enables centralized security management
- Scales from 1 to 1000+ servers

**Notifications & Alerting:**
- Real-time security notifications
- Integration with Slack, Discord, Teams, Email
- Critical security alerts
- Scheduled reports

**Webhooks:**
- External system integrations
- SIEM forwarding
- Custom workflows
- API callbacks

**Advanced Reporting:**
- Custom report templates
- PDF generation
- Scheduled reports
- Historical comparisons

---

## üîß Feature #1: Multi-Server Management Plugin

### Current State

**Existing Implementation:** `/multi-server/`
- `README.md` - Comprehensive documentation
- `scan-servers.sh` - Bash script for multi-server scanning
- `servers.yaml.example` - Server inventory template

**Functionality:**
- SSH-based remote scanning
- Parallel execution (GNU parallel)
- YAML inventory
- Group management
- Tag-based targeting
- Consolidated reports

### What Needs to Be Built

**Plugin Structure:** `/web-ui/plugins/multi-server/`

**Services Needed:**

1. **ServerManager** - Server inventory CRUD
   - Add/edit/delete servers
   - Group management
   - Tag management
   - Connection testing
   - Credential management

2. **ScanOrchestrator** - Distributed scan execution
   - Parallel scan execution
   - Job queue management
   - Progress tracking
   - Result aggregation
   - Failure handling

3. **ConnectionManager** - SSH connection handling
   - Connection pooling
   - Key management
   - Connection testing
   - Timeout handling
   - Error recovery

4. **ReportAggregator** - Multi-server reporting
   - Consolidated reports
   - Per-server reports
   - Comparison reports
   - Trend analysis
   - Export formats

5. **ScheduleManager** - Scheduled multi-server scans
   - Cron-based scheduling
   - Group scheduling
   - Recurring scans
   - On-demand scans

### API Endpoints (15 endpoints)

**Server Management:**
- `POST /api/multi-server/servers` - Add server
- `GET /api/multi-server/servers` - List servers
- `GET /api/multi-server/servers/:id` - Get server details
- `PUT /api/multi-server/servers/:id` - Update server
- `DELETE /api/multi-server/servers/:id` - Delete server
- `POST /api/multi-server/servers/:id/test` - Test connection

**Group Management:**
- `POST /api/multi-server/groups` - Create group
- `GET /api/multi-server/groups` - List groups
- `PUT /api/multi-server/groups/:id` - Update group
- `DELETE /api/multi-server/groups/:id` - Delete group

**Scan Operations:**
- `POST /api/multi-server/scan` - Start multi-server scan
- `GET /api/multi-server/scans` - List scan jobs
- `GET /api/multi-server/scans/:id` - Get scan status
- `DELETE /api/multi-server/scans/:id` - Cancel scan

**Reports:**
- `GET /api/multi-server/reports` - List consolidated reports
- `GET /api/multi-server/reports/:id` - Get report details

### Database Schema

**servers table:**
```sql
CREATE TABLE servers (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  host TEXT NOT NULL,
  port INTEGER DEFAULT 22,
  username TEXT NOT NULL,
  ssh_key_path TEXT,
  description TEXT,
  tags TEXT, -- JSON array
  status TEXT DEFAULT 'active', -- active, inactive, error
  last_scan DATETIME,
  last_status TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(tenant_id, name)
);
```

**server_groups table:**
```sql
CREATE TABLE server_groups (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  server_ids TEXT, -- JSON array of server IDs
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(tenant_id, name)
);
```

**multi_server_scans table:**
```sql
CREATE TABLE multi_server_scans (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT,
  server_ids TEXT, -- JSON array
  status TEXT, -- pending, running, completed, failed
  started_at DATETIME,
  completed_at DATETIME,
  total_servers INTEGER,
  completed_servers INTEGER,
  failed_servers INTEGER,
  results TEXT, -- JSON
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Integration Points

- **VPN Plugin:** Ensure scans go through VPN
- **Scanner Plugin:** Leverage existing scan functionality
- **Audit Plugin:** Log all multi-server operations
- **Tenants Plugin:** Multi-tenant isolation
- **Policies Plugin:** Apply policies across servers

### Testing Requirements

- [ ] Test server CRUD operations
- [ ] Test connection to 10+ servers
- [ ] Test parallel scanning (10 servers)
- [ ] Test group management
- [ ] Test tag-based filtering
- [ ] Test consolidated reporting
- [ ] Test failure scenarios
- [ ] Test tenant isolation
- [ ] Test SSH key authentication
- [ ] Test scan cancellation

### Estimated Time: 1-2 weeks

---

## üîî Feature #2: Notifications & Alerting Plugin

### Purpose

Real-time notifications for security events, scan completion, and critical alerts.

### Plugin Structure: `/web-ui/plugins/notifications/`

**Services Needed:**

1. **NotificationManager** - Central notification hub
   - Send notifications to multiple channels
   - Template management
   - Priority levels
   - Throttling/rate limiting
   - Notification history

2. **ChannelManager** - Notification channel configuration
   - Slack integration
   - Discord integration
   - Microsoft Teams integration
   - Email (SMTP)
   - Webhook integration
   - SMS (optional)

3. **AlertEngine** - Security alert generation
   - Critical vulnerability alerts
   - Scan failure alerts
   - Compliance threshold alerts
   - System health alerts
   - Custom alert rules

4. **TemplateManager** - Notification templates
   - Message formatting
   - Variable substitution
   - Multi-channel templates
   - Localization support

5. **ScheduleNotifier** - Scheduled notifications
   - Daily reports
   - Weekly summaries
   - Monthly compliance reports
   - Custom schedules

### API Endpoints (12 endpoints)

**Channel Configuration:**
- `POST /api/notifications/channels` - Add channel
- `GET /api/notifications/channels` - List channels
- `PUT /api/notifications/channels/:id` - Update channel
- `DELETE /api/notifications/channels/:id` - Delete channel
- `POST /api/notifications/channels/:id/test` - Test channel

**Notifications:**
- `POST /api/notifications/send` - Send notification
- `GET /api/notifications` - List sent notifications
- `GET /api/notifications/:id` - Get notification details

**Alert Rules:**
- `POST /api/notifications/rules` - Create alert rule
- `GET /api/notifications/rules` - List alert rules
- `PUT /api/notifications/rules/:id` - Update rule
- `DELETE /api/notifications/rules/:id` - Delete rule

### Notification Channels

**Slack:**
- Webhook URL
- Channel name
- Bot token
- Message formatting

**Discord:**
- Webhook URL
- Channel ID
- Message formatting
- Embed support

**Microsoft Teams:**
- Webhook URL
- Card formatting
- Adaptive cards

**Email (SMTP):**
- SMTP server
- Port, TLS
- Authentication
- Recipients
- HTML/Plain text

**Webhooks:**
- Custom URL
- HTTP method
- Headers
- Payload format

### Alert Types

1. **Critical Alerts** (Immediate)
   - Critical vulnerability found
   - Scan failure
   - System compromise detected
   - Authentication failure spike

2. **High Priority** (5 min delay)
   - High severity vulnerability
   - Compliance threshold breached
   - Resource limit reached
   - VPN connection lost

3. **Medium Priority** (15 min delay)
   - New medium vulnerabilities
   - Scan completed
   - Policy violation
   - Performance degradation

4. **Low Priority** (Daily digest)
   - Scan summaries
   - System updates
   - Usage statistics
   - Informational alerts

### Database Schema

**notification_channels table:**
```sql
CREATE TABLE notification_channels (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  type TEXT NOT NULL, -- slack, discord, email, webhook
  config TEXT NOT NULL, -- JSON config
  enabled INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**notification_history table:**
```sql
CREATE TABLE notification_history (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  channel_id TEXT NOT NULL,
  type TEXT, -- alert, report, info
  priority TEXT, -- critical, high, medium, low
  subject TEXT,
  message TEXT,
  status TEXT, -- sent, failed, pending
  sent_at DATETIME,
  error TEXT
);
```

**alert_rules table:**
```sql
CREATE TABLE alert_rules (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  condition TEXT NOT NULL, -- JSON rule definition
  channels TEXT, -- JSON array of channel IDs
  priority TEXT,
  enabled INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Integration Points

- **Scanner Plugin:** Alert on scan completion
- **Policies Plugin:** Alert on policy violations
- **VPN Plugin:** Alert on VPN issues
- **Audit Plugin:** Log all notifications
- **Multi-Server Plugin:** Alert on multi-server scan results

### Testing Requirements

- [ ] Test Slack integration
- [ ] Test Discord integration
- [ ] Test Email sending
- [ ] Test webhook delivery
- [ ] Test alert rule triggering
- [ ] Test priority levels
- [ ] Test throttling
- [ ] Test template rendering
- [ ] Test failure handling
- [ ] Test multi-channel sending

### Estimated Time: 1 week

---

## üîó Feature #3: Webhooks Plugin

### Purpose

Enable external system integrations and custom workflows through webhooks.

### Plugin Structure: `/web-ui/plugins/webhooks/`

**Services Needed:**

1. **WebhookManager** - Webhook configuration and management
   - CRUD operations
   - Event subscriptions
   - Payload formatting
   - Retry logic
   - Secret validation

2. **EventDispatcher** - Event routing
   - Event types
   - Event filtering
   - Payload generation
   - Async delivery
   - Batch delivery

3. **DeliveryManager** - HTTP delivery
   - HTTP client
   - Retry strategy
   - Timeout handling
   - Response logging
   - Failure alerts

4. **SecurityManager** - Webhook security
   - HMAC signing
   - IP whitelisting
   - Rate limiting
   - Payload validation

### API Endpoints (10 endpoints)

**Webhook Management:**
- `POST /api/webhooks` - Create webhook
- `GET /api/webhooks` - List webhooks
- `GET /api/webhooks/:id` - Get webhook details
- `PUT /api/webhooks/:id` - Update webhook
- `DELETE /api/webhooks/:id` - Delete webhook
- `POST /api/webhooks/:id/test` - Test webhook

**Delivery:**
- `GET /api/webhooks/:id/deliveries` - List deliveries
- `GET /api/webhooks/:id/deliveries/:delivery_id` - Get delivery details
- `POST /api/webhooks/:id/deliveries/:delivery_id/redeliver` - Retry delivery

**Events:**
- `GET /api/webhooks/events` - List available events

### Event Types

**Scan Events:**
- `scan.started` - Scan initiated
- `scan.completed` - Scan finished
- `scan.failed` - Scan failed
- `vulnerability.found` - Vulnerability detected

**Compliance Events:**
- `policy.executed` - Policy scan executed
- `policy.passed` - Policy passed
- `policy.failed` - Policy failed
- `compliance.threshold` - Threshold breached

**System Events:**
- `server.added` - New server added
- `server.removed` - Server removed
- `user.created` - New user created
- `tenant.created` - New tenant created

**Alert Events:**
- `alert.triggered` - Alert condition met
- `alert.resolved` - Alert resolved

### Payload Format

```json
{
  "event": "scan.completed",
  "timestamp": "2025-10-14T01:25:00Z",
  "tenant_id": "tenant-123",
  "data": {
    "scan_id": "scan-456",
    "server": "web-prod-01",
    "status": "completed",
    "vulnerabilities": {
      "critical": 0,
      "high": 2,
      "medium": 5,
      "low": 12
    },
    "duration": 127,
    "report_url": "https://scanner.example.com/reports/scan-456"
  },
  "signature": "sha256=abc123..."
}
```

### Database Schema

**webhooks table:**
```sql
CREATE TABLE webhooks (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  url TEXT NOT NULL,
  events TEXT NOT NULL, -- JSON array
  secret TEXT, -- For HMAC signing
  enabled INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**webhook_deliveries table:**
```sql
CREATE TABLE webhook_deliveries (
  id TEXT PRIMARY KEY,
  webhook_id TEXT NOT NULL,
  event TEXT NOT NULL,
  payload TEXT NOT NULL,
  status TEXT, -- pending, success, failed
  status_code INTEGER,
  response TEXT,
  attempts INTEGER DEFAULT 0,
  next_retry DATETIME,
  delivered_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Integration Points

- **All Plugins:** Can trigger webhook events
- **Notifications Plugin:** Alternative delivery method
- **Audit Plugin:** Log webhook deliveries

### Testing Requirements

- [ ] Test webhook creation
- [ ] Test event triggering
- [ ] Test payload delivery
- [ ] Test HMAC signing
- [ ] Test retry logic
- [ ] Test failure handling
- [ ] Test multiple webhooks
- [ ] Test event filtering
- [ ] Test tenant isolation

### Estimated Time: 3-5 days

---

## üìä Feature #4: Advanced Reporting Plugin

### Purpose

Enhanced reporting capabilities with custom templates, PDF generation, and scheduled reports.

### Plugin Structure: `/web-ui/plugins/advanced-reporting/`

**Services Needed:**

1. **ReportGenerator** - Report generation
   - Template rendering
   - Data aggregation
   - Format conversion
   - Custom filters

2. **TemplateManager** - Report templates
   - Template CRUD
   - Variable substitution
   - Conditional sections
   - Formatting options

3. **PDFGenerator** - PDF creation
   - HTML to PDF conversion
   - Custom styling
   - Charts/graphs
   - Multi-page support

4. **ScheduleManager** - Scheduled reports
   - Cron-based scheduling
   - Recipient management
   - Automatic delivery
   - Archive management

5. **HistoricalAnalyzer** - Trend analysis
   - Time-series comparison
   - Delta reports
   - Improvement tracking
   - Predictive analysis

### API Endpoints (12 endpoints)

**Templates:**
- `POST /api/reports/templates` - Create template
- `GET /api/reports/templates` - List templates
- `GET /api/reports/templates/:id` - Get template
- `PUT /api/reports/templates/:id` - Update template
- `DELETE /api/reports/templates/:id` - Delete template

**Generation:**
- `POST /api/reports/generate` - Generate report
- `GET /api/reports` - List reports
- `GET /api/reports/:id` - Get report
- `GET /api/reports/:id/download` - Download report

**Scheduling:**
- `POST /api/reports/schedules` - Create schedule
- `GET /api/reports/schedules` - List schedules
- `PUT /api/reports/schedules/:id` - Update schedule

### Report Types

**Executive Summary:**
- High-level overview
- Key metrics
- Trend analysis
- Action items

**Technical Report:**
- Detailed findings
- Vulnerability details
- Remediation steps
- Code snippets

**Compliance Report:**
- Policy results
- Compliance score
- Requirements matrix
- Evidence collection

**Comparison Report:**
- Before/after analysis
- Multiple servers
- Historical trends
- Improvement tracking

**Custom Report:**
- User-defined template
- Flexible formatting
- Custom data selection

### Database Schema

**report_templates table:**
```sql
CREATE TABLE report_templates (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  template TEXT NOT NULL, -- HTML/Markdown template
  format TEXT DEFAULT 'html', -- html, pdf, markdown
  variables TEXT, -- JSON array
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**generated_reports table:**
```sql
CREATE TABLE generated_reports (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  template_id TEXT,
  name TEXT NOT NULL,
  format TEXT,
  content TEXT,
  file_path TEXT,
  size INTEGER,
  generated_by TEXT,
  generated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**report_schedules table:**
```sql
CREATE TABLE report_schedules (
  id TEXT PRIMARY KEY,
  tenant_id TEXT NOT NULL,
  template_id TEXT NOT NULL,
  name TEXT NOT NULL,
  schedule TEXT NOT NULL, -- Cron expression
  recipients TEXT, -- JSON array
  enabled INTEGER DEFAULT 1,
  last_run DATETIME,
  next_run DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Integration Points

- **Scanner Plugin:** Pull scan data
- **Policies Plugin:** Pull compliance data
- **Multi-Server Plugin:** Aggregate multi-server data
- **Notifications Plugin:** Deliver reports
- **Storage Plugin:** Store generated reports

### Testing Requirements

- [ ] Test template creation
- [ ] Test report generation
- [ ] Test PDF generation
- [ ] Test scheduled reports
- [ ] Test historical comparison
- [ ] Test multiple formats
- [ ] Test large reports
- [ ] Test template variables
- [ ] Test delivery

### Estimated Time: 1 week

---

## üìÖ Implementation Timeline

### Total Estimated Time: 3-4 weeks

**Week 1: Multi-Server Plugin**
- Days 1-3: Server management & database
- Days 4-5: Scan orchestration
- Days 6-7: Testing & integration

**Week 2: Notifications Plugin**
- Days 1-2: Channel management
- Days 3-4: Alert engine & templates
- Days 5: Integration & testing

**Week 3: Webhooks & Advanced Reporting**
- Days 1-2: Webhooks plugin
- Days 3-5: Advanced reporting plugin
- Days 6-7: Testing & integration

**Week 4: Polish & Testing**
- Days 1-3: Comprehensive testing
- Days 4-5: Bug fixes & optimization
- Days 6-7: Documentation & release

---

## ‚úÖ Success Criteria

### Multi-Server Plugin
- [ ] Manage 100+ servers
- [ ] Parallel scanning working
- [ ] Consolidated reporting
- [ ] SSH authentication secure
- [ ] Group/tag management functional

### Notifications Plugin
- [ ] 4+ notification channels working
- [ ] Alert rules triggering correctly
- [ ] Templates rendering properly
- [ ] Throttling functional
- [ ] Multi-tenant isolation

### Webhooks Plugin
- [ ] Webhook delivery reliable
- [ ] HMAC signing working
- [ ] Retry logic functional
- [ ] Event filtering accurate
- [ ] Delivery logging complete

### Advanced Reporting Plugin
- [ ] PDF generation working
- [ ] Custom templates functional
- [ ] Scheduled reports delivering
- [ ] Historical comparison accurate
- [ ] Multiple formats supported

---

## üéØ Post-Implementation: v4.7.0 Web UI

After v4.6.0 backend features are complete, we'll have:

**Complete Backend:**
- 15 plugins operational
- 50+ services
- 180+ API endpoints
- Multi-server management
- Real-time notifications
- Webhook integrations
- Advanced reporting

**Ready for UI:**
- Stable API (frozen)
- All features tested
- Performance optimized
- Security hardened
- Comprehensive documentation

**UI Development Timeline:** 2-3 months for complete web dashboard

---

## üìù Notes

**User Priority:** Complete backend before UI  
**Approach:** Systematic, quality-focused  
**Testing:** Comprehensive testing required  
**Documentation:** Document as we build

**Key Principle:** Build foundation completely before presentation layer

---

**Created:** 2025-10-14 01:25:00 UTC  
**Version:** v4.6.0 Planning  
**Status:** Ready to begin implementation  
**First Feature:** Multi-Server Management Plugin
